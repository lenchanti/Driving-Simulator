import pandas as pd
import os
import csv
import matplotlib.pyplot as plt
import numpy as np
from mpl_toolkits.mplot3d import Axes3D

import seaborn as sns

result_folder = "C:\\Users\\user\\Desktop\\result\\eye_result"

eye_df =pd.DataFrame()
for result_files in os.listdir(result_folder):
    eye_file = pd.read_csv(os.path.join(result_folder, result_files)).drop(['GazedObjName', 'GazedObjTag', 's_GazedObjsName',
           's_GazedObjsTag'],axis=1)
    eye_df = pd.concat([eye_df , eye_file], axis=0)

eye_df_movement = eye_df.groupby(['subject', 'condition']).agg({
    'movement_distance': 'sum'
}).reset_index()
eye_condition_stats = eye_df_movement.groupby(['condition']).agg(
    s=('movement_distance', 'sum'),  # 여기에 eye movement를 나타내는 열 이름을 지정
    total_distance=('movement_distance', 'sum'),   # 총 이동 거리
    mean_distance=('movement_distance', 'mean'),  # 평균 이동 거리
    std_dev=('movement_distance', 'std'),         # 표준편차
    count=('movement_distance', 'count')          # 데이터 개수
).reset_index()


# 조건별로 groupby하여 평균 및 표준오차 계산
eye_condition_stats['std_error'] =eye_condition_stats ['std_dev'] / eye_condition_stats['count']**0.5


# 결과 출력
print("\nCondition-wise Eye Movement Statistics:")
print(eye_condition_stats)

from scipy import stats

# 조건별 eye movement 데이터를 리스트로 분리
eye_movement_by_condition = [
    eye_df_movement[eye_df_movement['condition'] == cond]['movement_distance']  # 여기에 eye movement 열 이름을 지정
    for cond in eye_df_movement['condition'].unique()
]

# ANOVA 수행
f_stat, p_value = stats.f_oneway(*eye_movement_by_condition)

# 결과 출력
print(f"\nANOVA Result for Eye Movement by Condition:\nF-statistic: {f_stat:.4f}, p-value: {p_value:.4e}")

# 해석
if p_value < 0.05:
    print("There is a significant difference in eye movement between conditions (p < 0.05).")
else:
    print("There is no significant difference in eye movement between conditions (p >= 0.05).")

from statsmodels.stats.multicomp import pairwise_tukeyhsd

# Tukey HSD Test 수행
tukey_result = pairwise_tukeyhsd(
    endog=eye_df['movement_distance'],  # 여기에 eye movement 열 이름을 지정
    groups=eye_df['condition'],          # 조건 열
    alpha=0.05                           # 유의 수준
)

# 결과 출력
print("\nTukey HSD Test Results:")
print(tukey_result)

